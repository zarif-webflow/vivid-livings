{
  "version": 3,
  "sources": ["../src/features/hero-location-search-filter.ts"],
  "sourcesContent": ["import { getHtmlElement } from \"@taj-wf/utils\";\r\nimport { debounce } from \"es-toolkit\";\r\n\r\nimport type { ListFilterCondition, ListInstance } from \"@/types/finsweet-attributes-list\";\r\nimport {\r\n  generateSearchQueryParams,\r\n  getAllFieldsValues,\r\n  getAppliedFilters,\r\n} from \"@/utils/finsweet-list-helpers\";\r\n\r\nconst fsListInstanceNames = {\r\n  buy: \"property-buy-search\",\r\n  rent: \"property-rent-search\",\r\n  offplan: \"offplan-search\",\r\n};\r\n\r\nconst fsListFieldNames = {\r\n  buy: \"location-text\",\r\n  rent: \"location-text\",\r\n  offplan: \"name-with-location\",\r\n};\r\n\r\nconst configs = {\r\n  buy: {\r\n    pageSlug: \"buy\",\r\n    fsListInstanceName: fsListInstanceNames.buy,\r\n    selectors: {\r\n      locationSearchInput: `[fs-list-instance=${fsListInstanceNames.buy}] input[fs-list-field=${fsListFieldNames.buy}][data-input-combobox=input]`,\r\n      searchButton: `[fs-list-instance=${fsListInstanceNames.buy}] form button[data-search-button=true]`,\r\n    },\r\n    fieldName: fsListFieldNames.buy,\r\n  },\r\n  rent: {\r\n    pageSlug: \"rent\",\r\n    fsListInstanceName: fsListInstanceNames.rent,\r\n    selectors: {\r\n      locationSearchInput: `[fs-list-instance=${fsListInstanceNames.rent}] input[fs-list-field=${fsListFieldNames.rent}][data-input-combobox=input]`,\r\n      searchButton: `[fs-list-instance=${fsListInstanceNames.rent}] form button[data-search-button=true]`,\r\n    },\r\n    fieldName: fsListFieldNames.rent,\r\n  },\r\n  offplan: {\r\n    pageSlug: \"off-plan\",\r\n    fsListInstanceName: fsListInstanceNames.offplan,\r\n    selectors: {\r\n      locationSearchInput: `[fs-list-instance=${fsListInstanceNames.offplan}] input[fs-list-field=${fsListFieldNames.offplan}][data-input-combobox=input]`,\r\n      searchButton: `[fs-list-instance=${fsListInstanceNames.offplan}] form button[data-search-button=true]`,\r\n    },\r\n    fieldName: fsListFieldNames.offplan,\r\n  },\r\n};\r\n\r\nconst initLocationSearch = ({\r\n  fsListInstanceName,\r\n  pageSlug,\r\n  selectors: SELECTORS,\r\n  fieldName,\r\n}: (typeof configs)[keyof typeof configs]) => {\r\n  const locationSearchInput = getHtmlElement<HTMLComboboxInputElement>({\r\n    selector: SELECTORS.locationSearchInput,\r\n  });\r\n\r\n  if (!locationSearchInput) {\r\n    console.error(\"Location search input not found\", SELECTORS.locationSearchInput);\r\n    return;\r\n  }\r\n\r\n  const searchButton = getHtmlElement<HTMLButtonElement>({\r\n    selector: SELECTORS.searchButton,\r\n  });\r\n\r\n  if (!searchButton) {\r\n    console.error(\"Search button not found\", SELECTORS.searchButton);\r\n    return;\r\n  }\r\n\r\n  let searchParamsPrefix = locationSearchInput.getAttribute(\"data-search-params-prefix\");\r\n  if (!searchParamsPrefix) {\r\n    console.debug(\"Search params prefix not found, using default value\");\r\n    searchParamsPrefix = \"\";\r\n  }\r\n\r\n  let comboboxApi = locationSearchInput.comboboxApi;\r\n  let comboboxResults: string[] = [];\r\n  let listFilterConditions: ListFilterCondition[] = [];\r\n  let listInstance: ListInstance | undefined = undefined;\r\n\r\n  locationSearchInput.addEventListener(\"combobox-init\", (event) => {\r\n    comboboxApi = event.detail.api;\r\n  });\r\n\r\n  window.FinsweetAttributes ||= [];\r\n  window.FinsweetAttributes.push([\r\n    \"list\",\r\n    (instances) => {\r\n      for (const instance of instances) {\r\n        if (instance.instance !== fsListInstanceName) continue;\r\n\r\n        listInstance = instance;\r\n\r\n        instance.addHook(\"filter\", (items) => {\r\n          const allFieldValues = getAllFieldsValues(items);\r\n\r\n          const newComboboxResults = new Set<string>();\r\n\r\n          for (const fieldValue of allFieldValues) {\r\n            const nameWithLocation = fieldValue[fieldName]?.value;\r\n            if (typeof nameWithLocation !== \"string\") continue;\r\n            newComboboxResults.add(nameWithLocation);\r\n          }\r\n\r\n          comboboxResults = Array.from(newComboboxResults);\r\n\r\n          const appliedFilters = getAppliedFilters(instance);\r\n          listFilterConditions = appliedFilters;\r\n          return items;\r\n        });\r\n      }\r\n    },\r\n  ]);\r\n\r\n  const debouncedLocationInputCallback = debounce((value: string, comboboxApi: ComboboxAPI) => {\r\n    if (!value.trim()) {\r\n      comboboxApi.renderResults([]);\r\n      comboboxApi.closeResultModal();\r\n      return;\r\n    }\r\n\r\n    comboboxApi.renderResults(comboboxResults);\r\n    comboboxApi.openResultModal();\r\n  }, 200);\r\n\r\n  locationSearchInput.addEventListener(\"input\", () => {\r\n    if (!comboboxApi) {\r\n      console.error(\"Combobox API not found\", locationSearchInput);\r\n      return;\r\n    }\r\n\r\n    const value: string = locationSearchInput.value;\r\n\r\n    debouncedLocationInputCallback(value, comboboxApi);\r\n  });\r\n\r\n  searchButton.addEventListener(\"click\", () => {\r\n    const query = generateSearchQueryParams(listFilterConditions, searchParamsPrefix);\r\n    const baseUrl = window.location.origin;\r\n    const fullUrl = `${baseUrl}/${pageSlug}${query}`;\r\n    window.location.href = fullUrl;\r\n  });\r\n\r\n  locationSearchInput.addEventListener(\"combobox-select\", (event) => {\r\n    const selectedValue = event.detail.selectedValue;\r\n\r\n    const filtersObjectConditions = listInstance?.filters.value.groups[0]?.conditions;\r\n\r\n    if (filtersObjectConditions) {\r\n      for (const condition of filtersObjectConditions) {\r\n        if (condition.fieldKey === fieldName) {\r\n          condition.value = selectedValue;\r\n        }\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nconst init = () => {\r\n  initLocationSearch(configs.buy);\r\n  initLocationSearch(configs.rent);\r\n  initLocationSearch(configs.offplan);\r\n};\r\n\r\ninit();\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;AAAA;AAUA,IAAM,sBAAsB;AAAA,EAC1B,KAAK;AAAA,EACL,MAAM;AAAA,EACN,SAAS;AACX;AAEA,IAAM,mBAAmB;AAAA,EACvB,KAAK;AAAA,EACL,MAAM;AAAA,EACN,SAAS;AACX;AAEA,IAAM,UAAU;AAAA,EACd,KAAK;AAAA,IACH,UAAU;AAAA,IACV,oBAAoB,oBAAoB;AAAA,IACxC,WAAW;AAAA,MACT,qBAAqB,qBAAqB,oBAAoB,GAAG,yBAAyB,iBAAiB,GAAG;AAAA,MAC9G,cAAc,qBAAqB,oBAAoB,GAAG;AAAA,IAC5D;AAAA,IACA,WAAW,iBAAiB;AAAA,EAC9B;AAAA,EACA,MAAM;AAAA,IACJ,UAAU;AAAA,IACV,oBAAoB,oBAAoB;AAAA,IACxC,WAAW;AAAA,MACT,qBAAqB,qBAAqB,oBAAoB,IAAI,yBAAyB,iBAAiB,IAAI;AAAA,MAChH,cAAc,qBAAqB,oBAAoB,IAAI;AAAA,IAC7D;AAAA,IACA,WAAW,iBAAiB;AAAA,EAC9B;AAAA,EACA,SAAS;AAAA,IACP,UAAU;AAAA,IACV,oBAAoB,oBAAoB;AAAA,IACxC,WAAW;AAAA,MACT,qBAAqB,qBAAqB,oBAAoB,OAAO,yBAAyB,iBAAiB,OAAO;AAAA,MACtH,cAAc,qBAAqB,oBAAoB,OAAO;AAAA,IAChE;AAAA,IACA,WAAW,iBAAiB;AAAA,EAC9B;AACF;AAEA,IAAM,qBAAqB,CAAC;AAAA,EAC1B;AAAA,EACA;AAAA,EACA,WAAW;AAAA,EACX;AACF,MAA8C;AAC5C,QAAM,sBAAsB,eAAyC;AAAA,IACnE,UAAU,UAAU;AAAA,EACtB,CAAC;AAED,MAAI,CAAC,qBAAqB;AACxB,YAAQ,MAAM,mCAAmC,UAAU,mBAAmB;AAC9E;AAAA,EACF;AAEA,QAAM,eAAe,eAAkC;AAAA,IACrD,UAAU,UAAU;AAAA,EACtB,CAAC;AAED,MAAI,CAAC,cAAc;AACjB,YAAQ,MAAM,2BAA2B,UAAU,YAAY;AAC/D;AAAA,EACF;AAEA,MAAI,qBAAqB,oBAAoB,aAAa,2BAA2B;AACrF,MAAI,CAAC,oBAAoB;AACvB,YAAQ,MAAM,qDAAqD;AACnE,yBAAqB;AAAA,EACvB;AAEA,MAAI,cAAc,oBAAoB;AACtC,MAAI,kBAA4B,CAAC;AACjC,MAAI,uBAA8C,CAAC;AACnD,MAAI,eAAyC;AAE7C,sBAAoB,iBAAiB,iBAAiB,CAAC,UAAU;AAC/D,kBAAc,MAAM,OAAO;AAAA,EAC7B,CAAC;AAED,SAAO,uBAAuB,CAAC;AAC/B,SAAO,mBAAmB,KAAK;AAAA,IAC7B;AAAA,IACA,CAAC,cAAc;AACb,iBAAW,YAAY,WAAW;AAChC,YAAI,SAAS,aAAa,mBAAoB;AAE9C,uBAAe;AAEf,iBAAS,QAAQ,UAAU,CAAC,UAAU;AACpC,gBAAM,iBAAiB,mBAAmB,KAAK;AAE/C,gBAAM,qBAAqB,oBAAI,IAAY;AAE3C,qBAAW,cAAc,gBAAgB;AACvC,kBAAM,mBAAmB,WAAW,SAAS,GAAG;AAChD,gBAAI,OAAO,qBAAqB,SAAU;AAC1C,+BAAmB,IAAI,gBAAgB;AAAA,UACzC;AAEA,4BAAkB,MAAM,KAAK,kBAAkB;AAE/C,gBAAM,iBAAiB,kBAAkB,QAAQ;AACjD,iCAAuB;AACvB,iBAAO;AAAA,QACT,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF,CAAC;AAED,QAAM,iCAAiC,SAAS,CAAC,OAAeA,iBAA6B;AAC3F,QAAI,CAAC,MAAM,KAAK,GAAG;AACjB,MAAAA,aAAY,cAAc,CAAC,CAAC;AAC5B,MAAAA,aAAY,iBAAiB;AAC7B;AAAA,IACF;AAEA,IAAAA,aAAY,cAAc,eAAe;AACzC,IAAAA,aAAY,gBAAgB;AAAA,EAC9B,GAAG,GAAG;AAEN,sBAAoB,iBAAiB,SAAS,MAAM;AAClD,QAAI,CAAC,aAAa;AAChB,cAAQ,MAAM,0BAA0B,mBAAmB;AAC3D;AAAA,IACF;AAEA,UAAM,QAAgB,oBAAoB;AAE1C,mCAA+B,OAAO,WAAW;AAAA,EACnD,CAAC;AAED,eAAa,iBAAiB,SAAS,MAAM;AAC3C,UAAM,QAAQ,0BAA0B,sBAAsB,kBAAkB;AAChF,UAAM,UAAU,OAAO,SAAS;AAChC,UAAM,UAAU,GAAG,OAAO,IAAI,QAAQ,GAAG,KAAK;AAC9C,WAAO,SAAS,OAAO;AAAA,EACzB,CAAC;AAED,sBAAoB,iBAAiB,mBAAmB,CAAC,UAAU;AACjE,UAAM,gBAAgB,MAAM,OAAO;AAEnC,UAAM,0BAA0B,cAAc,QAAQ,MAAM,OAAO,CAAC,GAAG;AAEvE,QAAI,yBAAyB;AAC3B,iBAAW,aAAa,yBAAyB;AAC/C,YAAI,UAAU,aAAa,WAAW;AACpC,oBAAU,QAAQ;AAAA,QACpB;AAAA,MACF;AAAA,IACF;AAAA,EACF,CAAC;AACH;AAEA,IAAM,OAAO,MAAM;AACjB,qBAAmB,QAAQ,GAAG;AAC9B,qBAAmB,QAAQ,IAAI;AAC/B,qBAAmB,QAAQ,OAAO;AACpC;AAEA,KAAK;",
  "names": ["comboboxApi"]
}
